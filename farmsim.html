<!DOCTYPE html>
<html lang="en">
<head>
	<title>Farm Simulator Game Test</title>
	<meta charset="UTF-8" />
	<script type="text/javascript" src="xorshift.js"></script>
	<script type="text/javascript" src="pixi.dev.js"></script>
	<script type="text/javascript" src="FarmGame.js"></script>
	<script type="text/javascript">
var width;
var height;

var game;

window.onload = function() {
	width = 640;
	height = 480;
	var renderer = PIXI.autoDetectRenderer(width, height);

	document.getElementById("stage").appendChild(renderer.view);

	var stage = new PIXI.Stage;

	game = new FarmGame(width / 32, height / 32);

	var groundTexture = PIXI.Texture.fromImage("assets/dirt.png");
	var ridgeTexture = PIXI.Texture.fromImage("assets/ridge.png");
	var grassTextures = [
		PIXI.Texture.fromImage("assets/grass1.png"),
		PIXI.Texture.fromImage("assets/grass2.png"),
		PIXI.Texture.fromImage("assets/grass3.png"),
	];
	var grassThresholds = [
		0.25, 0.50, 0.75
	];

	game.onUpdateCell = function(cell,x,y){
		if(cell.gs == undefined){
			var groundSprite = new PIXI.Sprite(groundTexture);
			groundSprite.position.x = x * 32;
			groundSprite.position.y = y * 32;
			groundSprite.interactive = true;
			groundSprite.mousedown = function(id){
				id.target.setTexture(ridgeTexture);
			};
			stage.addChild(groundSprite);
			cell.gs = groundSprite;
		}
		for(var grassIndex = 0; grassIndex < grassTextures.length; grassIndex++){
			if(cell.grass < grassThresholds[grassIndex])
				break;
		}
		if(0 < grassIndex){
			if(cell.grassSprite == undefined){
				var grassSprite = new PIXI.Sprite(grassTextures[grassIndex - 1]);

				grassSprite.position = cell.gs.position;
				stage.addChild(grassSprite);
				cell.grassSprite = grassSprite;
			}
			else
				cell.grassSprite.setTexture(grassTextures[grassIndex - 1]);
		}
	}

	game.init();

	requestAnimationFrame(animate);

	function animate() {
		game.update();

		renderer.render(stage);

		requestAnimationFrame(animate);
	}
}
	</script>
</head>
<body>
<div id="header">
	<h1>Farm Simulator Game Test</h1>
</div>
<div id="stage"></div>
<hr>
Powered by <a href="https://github.com/GoodBoyDigital/pixi.js">PIXI.js</a>
</body>
</html>
