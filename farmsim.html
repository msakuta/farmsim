<!DOCTYPE html>
<html lang="en">
<head>
	<title>Farm Simulator Game Test</title>
	<meta charset="UTF-8" />
	<script type="text/javascript" src="xorshift.js"></script>
	<script type="text/javascript" src="pixi.dev.js"></script>
	<script type="text/javascript">
var width;
var height;

window.onload = function() {
	width = 640;
	height = 480;
	var renderer = PIXI.autoDetectRenderer(width, height);

	document.getElementById("stage").appendChild(renderer.view);

	var stage = new PIXI.Stage;

	var rng = new Xor128();

	var cells = [[]];

	var groundTexture = PIXI.Texture.fromImage("assets/dirt.png");
	var ridgeTexture = PIXI.Texture.fromImage("assets/ridge.png");
	var grassTextures = [
		PIXI.Texture.fromImage("assets/grass1.png"),
		PIXI.Texture.fromImage("assets/grass2.png"),
		PIXI.Texture.fromImage("assets/grass3.png"),
	];
	var grassThresholds = [
		0.25, 0.50, 0.75
	];
	for(var x = 0; x < width / 32; x++){
		var row = [];
		for(var y = 0; y < height / 32; y++){
			var groundSprite = new PIXI.Sprite(groundTexture);

			groundSprite.position.x = x * 32;
			groundSprite.position.y = y * 32;
			groundSprite.interactive = true;
			groundSprite.mousedown = function(id){
				id.target.setTexture(ridgeTexture);
			};
			stage.addChild(groundSprite);

			var grass = rng.next();
			var cell = {gs: groundSprite, grass: grass, grassSprite: null};
			for(var grassIndex = 0; grassIndex < grassTextures.length; grassIndex++){
				if(grass < grassThresholds[grassIndex])
					break;
			}
			if(0 < grassIndex){
				var grassSprite = new PIXI.Sprite(grassTextures[grassIndex - 1]);

				grassSprite.position.x = x * 32;
				grassSprite.position.y = y * 32;
				stage.addChild(grassSprite);
				cell.grassSprite = grassSprite;
			}
			row.push(cell);
		}
		cells.push(row);
	}

	requestAnimationFrame(animate);

	function animate() {
		var growth = 0.0001;

		for(var x = 0; x < cells.length; x++){
			for(var y = 0; y < cells[x].length; y++){
				var cell = cells[x][y];
				for(var grassIndex = 0; grassIndex < grassTextures.length; grassIndex++){
					if(cell.grass + growth < grassThresholds[grassIndex])
						break;
				}
				if(0 < grassIndex){
					if(cell.grassSprite == null){
						var grassSprite = new PIXI.Sprite(grassTextures[grassIndex - 1]);

						grassSprite.position = cell.gs.position;
						stage.addChild(grassSprite);
						cell.grassSprite = grassSprite;
					}
					else
						cell.grassSprite.setTexture(grassTextures[grassIndex - 1]);
				}
				if(cell.grass < 1. - growth)
					cell.grass += growth;
				else
					cell.grass = 1.;
			}
		}

		renderer.render(stage);

		requestAnimationFrame(animate);
	}
}
	</script>
</head>
<body>
<div id="header">
	<h1>Farm Simulator Game Test</h1>
</div>
<div id="stage"></div>
<hr>
Powered by <a href="https://github.com/GoodBoyDigital/pixi.js">PIXI.js</a>
</body>
</html>
